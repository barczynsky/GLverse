#pragma once
#include <cstdint>

// Approx. optimized x86 code:
// add %eax,%ebx
// sbb %eax,%eax
// or  %ebx,%eax
inline uint32_t saturate_add(uint32_t a, uint32_t b)
{
	uint64_t s = (uint64_t)a + b;
	return -(s >> 32) | (uint32_t)s;
}

inline uint16_t saturate_add(uint16_t a, uint16_t b)
{
	uint32_t s = (uint32_t)a + b;
	return -(s >> 16) | (uint16_t)s;
}

inline uint8_t saturate_add(uint8_t a, uint8_t b)
{
	uint32_t s = (uint32_t)a + b;
	return -(s >> 8) | (uint8_t)s;
}
